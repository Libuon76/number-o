<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>æ•°å­—å½“ã¦ã‚²ãƒ¼ãƒ </title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a2e"> <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªãƒ•ã‚©ãƒ³ãƒˆè¨­å®šã¨èƒŒæ™¯è‰² */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e; /* ãƒ€ãƒ¼ã‚¯ãƒã‚¤ãƒ“ãƒ¼ã®èƒŒæ™¯ */
            color: #e0e0e0; /* æ˜ã‚‹ã„ãƒ†ã‚­ã‚¹ãƒˆ */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        /* ãƒœã‚¿ãƒ³ã®ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #messageArea {
            min-height: 4.5rem; /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å®‰å®šã•ã›ã‚‹ãŸã‚ã®æœ€å°é«˜ã• */
            line-height: 1.5;
        }
        /* ç§˜å¯†ã®æ•°å­—å…¥åŠ›ã‚¨ãƒªã‚¢ã‚’ä¸­å¤®ã«é…ç½® */
        #secretSetterArea input {
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="space-y-6 flex flex-col items-center">
        <h1 class="text-5xl font-extrabold text-indigo-400">æ•°å­—å½“ã¦PWAã‚²ãƒ¼ãƒ </h1>
        <p class="text-center max-w-lg text-gray-300">
            ç§˜å¯†ã®æ•°å­—ã‚’äºˆæƒ³ã—ã¦ã­ï¼è¨­å®šã•ã‚ŒãŸæ•°å­—ã‚’å½“ã¦ã‚‹ã¾ã§ã€äºˆæƒ³ã‚’ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚æ­£è§£ã¾ã§ã®è©¦è¡Œå›æ•°ã‚’ç«¶ã„ã¾ã—ã‚‡ã†ã€‚
        </p>

        <div class="text-center p-8 bg-[#303450] rounded-2xl shadow-2xl border border-indigo-500/50 space-y-6 max-w-lg w-full" id="mainGameArea">

            <div id="secretSetterArea" class="space-y-4">
                <h2 class="text-2xl font-bold text-white">ã‚²ãƒ¼ãƒ è¨­å®š (1ã€œ100)</h2>
                <input type="number" id="secretNumberInput" class="w-full p-3 bg-[#4a4f78] text-white rounded-lg border border-indigo-500/50 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 text-2xl font-bold" placeholder="ç§˜å¯†ã®æ•°å­— (1ã€œ100)" min="1" max="100">
                <button id="setSecretButton" type="button" class="p-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg shadow-indigo-500/50 transition duration-300 btn-primary w-full">ã“ã®æ•°å­—ã‚’ç§˜å¯†ã«ã™ã‚‹</button>
            </div>

            <div id="guessInputArea" class="hidden space-y-4">
                <div class="flex gap-4">
                    <input type="number" id="guessField" class="flex-grow p-3 bg-[#4a4f78] text-white rounded-lg border border-indigo-500/50 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-400 text-2xl font-bold text-center" placeholder="äºˆæƒ³ (1ã€œ100)" min="1" max="100">
                    <button id="submitGuess" type="submit" class="p-3 bg-green-600 text-white font-bold rounded-xl shadow-lg shadow-green-500/50 transition duration-300 btn-primary">äºˆæƒ³ã‚’é€ä¿¡</button>
                </div>
            </div>

            <div id="resultArea" class="space-y-4">
                <div id="messageArea">
                    <p class="text-lg font-semibold mb-2 text-white" id="lastResult">ã•ã‚ã€äºˆæƒ³ã‚’å…¥åŠ›ã—ã¦ã­ï¼</p>
                    <p class="text-base font-medium text-indigo-300" id="lowOrHi">ç¾åœ¨ã®è©¦è¡Œå›æ•°: 1</p>
                </div>

                <p class="text-sm text-gray-400 break-words" id="guesses">å‰å›ã®äºˆæƒ³:</p>
            </div>

            <div class="mt-6 hidden text-center" id="resetArea">
                <button class="p-3 bg-pink-600 text-white font-bold rounded-xl shadow-lg shadow-pink-500/50 transition duration-300 btn-primary" id="resetButton" type="button">æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸</button>
            </div>
        </div>
        <div class="hidden text-center p-8 bg-[#303450] rounded-2xl shadow-2xl border border-green-500/50 space-y-8 max-w-lg w-full" id="finalResultArea">
            <h2 class="text-4xl font-extrabold text-green-300" id="finalResultTitle"></h2>
            <div class="text-left bg-[#4a4f78] p-6 rounded-lg space-y-3">
                <p class="text-xl font-semibold text-white">ğŸ† ç·åˆçµæœ:</p>
                <p class="text-lg text-gray-300" id="totalRounds">åˆè¨ˆãƒ©ã‚¦ãƒ³ãƒ‰æ•°: 0</p>
                <p class="text-lg text-gray-300" id="totalAttempts">åˆè¨ˆè©¦è¡Œå›æ•°: 0</p>
            </div>
            <button class="p-3 bg-yellow-600 text-white font-bold rounded-xl shadow-lg shadow-yellow-500/50 transition duration-300 btn-primary w-full" id="newGameButton" type="button">æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹</button>
        </div>
        </div>

    <script>
        // PWAåŒ–ã®ãŸã‚ã€ã“ã“ã‹ã‚‰Service Workerç™»éŒ²ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ 
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // service-worker.jsã¨ã„ã†åå‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç™»éŒ²
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered: ', registration);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed: ', error);
                    });
            });
        }
        // /PWAè¿½åŠ ã‚³ãƒ¼ãƒ‰

        // --- ã“ã“ã‹ã‚‰æ—¢å­˜ã®ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ ---
        // ç§˜å¯†ã®æ•°å­—
        let secretNumber = 0;
        // è©¦è¡Œå›æ•°
        let guessCount = 1;
        // å‰å›ã®äºˆæƒ³
        let guesses = [];
        // ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ç®¡ç†
        let gameOver = false;
        // ãƒ©ã‚¦ãƒ³ãƒ‰æ•°ã¨åˆè¨ˆè©¦è¡Œå›æ•°
        let roundCount = 0;
        let totalAttempts = 0;

        // HTMLè¦ç´ ã®å–å¾—
        const secretNumberInput = document.getElementById('secretNumberInput');
        const setSecretButton = document.getElementById('setSecretButton');
        const guessField = document.getElementById('guessField');
        const submitGuess = document.getElementById('submitGuess');
        const resetButton = document.getElementById('resetButton');
        const newGameButton = document.getElementById('newGameButton');

        // è¡¨ç¤ºã‚¨ãƒªã‚¢
        const secretSetterArea = document.getElementById('secretSetterArea');
        const guessInputArea = document.getElementById('guessInputArea');
        const mainGameArea = document.getElementById('mainGameArea');
        const finalResultArea = document.getElementById('finalResultArea');

        const lastResult = document.getElementById('lastResult');
        const lowOrHi = document.getElementById('lowOrHi');
        const previousGuesses = document.getElementById('guesses');
        const resetArea = document.getElementById('resetArea');
        const finalResultTitle = document.getElementById('finalResultTitle');
        const totalRounds = document.getElementById('totalRounds');
        const totalAttemptsDisplay = document.getElementById('totalAttempts');

        // ------------------------------------
        // ã‚²ãƒ¼ãƒ ã®é–‹å§‹ (ç§˜å¯†ã®æ•°å­—è¨­å®š)
        // ------------------------------------
        setSecretButton.addEventListener('click', setSecretNumber);

        function setSecretNumber() {
            const num = parseInt(secretNumberInput.value);

            if (num < 1 || num > 100 || isNaN(num)) {
                alert('ç§˜å¯†ã®æ•°å­—ã¯1ã‹ã‚‰100ã®é–“ã®æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            secretNumber = num;
            secretNumberInput.value = ''; // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢

            // è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ
            secretSetterArea.classList.add('hidden');
            guessInputArea.classList.remove('hidden');
            
            // åˆå›è¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            lastResult.textContent = 'ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼1ã‹ã‚‰100ã§äºˆæƒ³ã—ã¦ã­ã€‚';
            lowOrHi.textContent = 'ç¾åœ¨ã®è©¦è¡Œå›æ•°: 1';
            previousGuesses.textContent = 'å‰å›ã®äºˆæƒ³:';
            
            // è©¦è¡Œå›æ•°ã‚’ãƒªã‚»ãƒƒãƒˆ
            guessCount = 1;
            guesses = [];
            gameOver = false;
            roundCount++; // ãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹
        }


        // ------------------------------------
        // äºˆæƒ³ã®é€ä¿¡
        // ------------------------------------
        submitGuess.addEventListener('click', checkGuess);

        function checkGuess() {
            if (gameOver) return;

            const userGuess = Number(guessField.value);

            if (userGuess < 1 || userGuess > 100 || isNaN(userGuess)) {
                alert('1ã‹ã‚‰100ã®é–“ã®æœ‰åŠ¹ãªæ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                guessField.value = '';
                guessField.focus();
                return;
            }

            guesses.push(userGuess);
            previousGuesses.textContent = 'å‰å›ã®äºˆæƒ³: ' + guesses.join(', ');
            totalAttempts++; // åˆè¨ˆè©¦è¡Œå›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ

            if (userGuess === secretNumber) {
                lastResult.textContent = 'ğŸ‰ æ­£è§£ã§ã™ï¼ãŠã‚ã§ã¨ã†ï¼';
                lastResult.classList.remove('text-white', 'text-yellow-400');
                lastResult.classList.add('text-green-400');
                lowOrHi.textContent = `è©¦è¡Œå›æ•°: ${guessCount}å›ã§ã‚¯ãƒªã‚¢ï¼`;
                setGameOver();
            } else {
                lastResult.textContent = 'é–“é•ã„ã§ã™ï¼';
                lastResult.classList.remove('text-white', 'text-green-400');
                lastResult.classList.add('text-yellow-400');

                if (userGuess < secretNumber) {
                    lowOrHi.textContent = 'ãƒ’ãƒ³ãƒˆ: ã‚‚ã£ã¨å¤§ãã„ã‚ˆï¼';
                } else if (userGuess > secretNumber) {
                    lowOrHi.textContent = 'ãƒ’ãƒ³ãƒˆ: ã‚‚ã£ã¨å°ã•ã„ã‚ˆï¼';
                }

                guessCount++;
                lowOrHi.textContent += ` / ç¾åœ¨ã®è©¦è¡Œå›æ•°: ${guessCount}`;
            }

            guessField.value = '';
            guessField.focus();
        }

        // ------------------------------------
        // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼å‡¦ç†
        // ------------------------------------
        function setGameOver() {
            gameOver = true;
            guessField.disabled = true;
            submitGuess.disabled = true;
            resetArea.classList.remove('hidden');

            // 5ãƒ©ã‚¦ãƒ³ãƒ‰çµ‚äº†ã§ã‚²ãƒ¼ãƒ çµ‚äº†
            if (roundCount >= 5) {
                resetButton.textContent = 'ã‚²ãƒ¼ãƒ çµ‚äº†ï¼çµæœã‚’è¦‹ã‚‹';
                resetButton.removeEventListener('click', resetGame);
                resetButton.addEventListener('click', showFinalResult);
            } else {
                // 5ãƒ©ã‚¦ãƒ³ãƒ‰æœªæº€ãªã‚‰æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸
                resetButton.textContent = 'æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸';
                resetButton.removeEventListener('click', showFinalResult);
                resetButton.addEventListener('click', resetGame);
            }
        }

        // ------------------------------------
        // ãƒ©ã‚¦ãƒ³ãƒ‰ã®ãƒªã‚»ãƒƒãƒˆ
        // ------------------------------------
        function resetGame() {
            // ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            guessCount = 1;
            guesses = [];
            gameOver = false;

            // UIã‚’ãƒªã‚»ãƒƒãƒˆ
            lastResult.textContent = 'ã•ã‚ã€æ–°ã—ã„ç§˜å¯†ã®æ•°å­—ã‚’äºˆæƒ³ã—ã¦ã­ï¼';
            lastResult.classList.remove('text-green-400', 'text-yellow-400');
            lastResult.classList.add('text-white');
            lowOrHi.textContent = 'ç¾åœ¨ã®è©¦è¡Œå›æ•°: 1';
            previousGuesses.textContent = 'å‰å›ã®äºˆæƒ³:';

            guessField.disabled = false;
            submitGuess.disabled = false;
            guessField.value = '';
            guessField.focus();

            resetArea.classList.add('hidden');
            secretSetterArea.classList.remove('hidden');
            guessInputArea.classList.add('hidden');

            // ç§˜å¯†ã®æ•°å­—ã‚‚ãƒªã‚»ãƒƒãƒˆ
            secretNumber = 0;
        }

        // ------------------------------------
        // æœ€çµ‚çµæœè¡¨ç¤º
        // ------------------------------------
        function showFinalResult() {
            mainGameArea.classList.add('hidden');
            finalResultArea.classList.remove('hidden');

            finalResultTitle.textContent = 'ç·åˆçµæœç™ºè¡¨ï¼';
            totalRounds.textContent = `åˆè¨ˆãƒ©ã‚¦ãƒ³ãƒ‰æ•°: ${roundCount}`;
            totalAttemptsDisplay.textContent = `åˆè¨ˆè©¦è¡Œå›æ•°: ${totalAttempts}å›`;

            // æ–°ã—ã„ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã«ãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            newGameButton.addEventListener('click', startNewGame);
        }

        // ------------------------------------
        // æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’æœ€åˆã‹ã‚‰é–‹å§‹
        // ------------------------------------
        function startNewGame() {
            // å…¨ã¦ã®ç·åˆæƒ…å ±ã‚’ãƒªã‚»ãƒƒãƒˆ
            roundCount = 0;
            totalAttempts = 0;

            // UIã‚’ãƒªã‚»ãƒƒãƒˆ
            finalResultArea.classList.add('hidden');
            mainGameArea.classList.remove('hidden');
            
            // ãƒ©ã‚¦ãƒ³ãƒ‰ã®ãƒªã‚»ãƒƒãƒˆå‡¦ç†ã‚’å®Ÿè¡Œ
            resetGame();

            // æ–°ã—ã„ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã®ãƒªã‚¹ãƒŠãƒ¼ã‚’ä¸€åº¦å‰Šé™¤
            newGameButton.removeEventListener('click', startNewGame);

            // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®ãƒªã‚¹ãƒŠãƒ¼ã‚‚åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
            resetButton.removeEventListener('click', showFinalResult);
            resetButton.addEventListener('click', resetGame);
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒªã‚»ãƒƒãƒˆå‡¦ç†ã‚’å®Ÿè¡Œã—ã€åˆæœŸçŠ¶æ…‹ã«ã™ã‚‹
        window.onload = function() {
            startNewGame();
        };

    </script>
</body>
</html>
